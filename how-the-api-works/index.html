<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>How the API works - StoreFront SDK Documentation</title>
  

  <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link rel="stylesheet" href="../css/override.css" type="text/css" />
  <link rel="stylesheet" href="../css/font-awesome.css" type="text/css" />

  
  <script>
    // Current page data
    var mkdocs_page_name = "How the API works";
    var mkdocs_page_input_path = "how-the-api-works.md";
    var mkdocs_page_url = "/how-the-api-works/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script>
  <script src="../js/custom.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

	<div class="header-top">
		<div class="header-top-left">
			<a href="http://citrix.github.io" class="logo-position"><img height="60" src="https://thumbnail-ec2.sharefile.com/thumbnail.aspx?encparams=ypL2J0l-In6gqXJ7yeyKP8A1rqwKMH-C8-nfkJcHJNIN7Y0yZiJsYOcUe-uc0YeZzWLQSFSd1FnuMHPa30XSSINHuGOA8nvvnBT5WmjGlKvd5mxJ4IfT7iTVyHELwhWQiNCznPCiIFyhkA78uKX77PlU2iyhM4YdRM1NKabBe-4wXuiFJsbtAxyJ2UukO_E2ZSf1W3l75Dw8G0zflVkT-EFqyx1zSGId0qzLjm6nzJ8dA9zo-1AJzUisdzmGMzHOq_LMsOWyaalvmcWvCkl-q10GBSbfekfTIFW9LpZNYjkLNSnK8rcwNjWVr_jYayrGjIj2e5dDIMiDj3NRvW51AvHRjxYH9xRRRtY$" target="_blank" class="logo-citrix"><span style="color:#fff;font-size: 20px;position: relative;top:4px;left: 5px">SDK Reference</span></a>
		</div>
		<div class="header-top-right">
			<ul>
			<!--	<li class="list-inline home"><a href="..">HOME</a></li>
				<li class="list-inline support"><a href="http://support.citrix.com">SUPPORT</a></li>-->
			<form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
            <li class="list-inline support"><input name="q" id="txtName" type="text" placeholder="Search SDKs" 
            class="searchdocs"><a class="fa fa-search errspan" onclick="getElementById('rtd-search-form').submit()"></a></li>
			</form>
				<!--<li class="list-inline"><a href="http://citrix.com/download">DOWNLOADS</a></li>-->
			</ul>

		</div>
	</div>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
	<a class="fa fa-search" onclick="getElementById('rtd-search-form').submit()"></a>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="..">Overview</a>
			
		
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Web API</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../overview/">Overview</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 current">

		<a class="current" style="width:272px;" href="./">How the API works</a>
			
		
        
            <ul style="display:none">
            
				
                <li class="toctree-l3"><span class="expcli" style="margin-left: 10px;"><i class="fa fa-plus-square-o" aria-hidden="true"></i></span><a href="#how-the-api-works" style="display: inline-table;padding-left: 3px;width:240px;">How the API works</a></li>
				<ul style="display:none">
                
                    <li><a class="toctree-l4" href="#authentication-challenge">Authentication challenge</a></li>
                
                    <li><a class="toctree-l4" href="#client-name-client-address-and-device-id">Client Name, Client Address and Device Id</a></li>
                
                    <li><a class="toctree-l4" href="#cookies">Cookies</a></li>
                
                    <li><a class="toctree-l4" href="#https-indicator-to-secure-cookies">HTTPS indicator to secure cookies</a></li>
                
                    <li><a class="toctree-l4" href="#cross-site-request-forgery-token">Cross-site request forgery token</a></li>
                
                    <li><a class="toctree-l4" href="#localization">Localization</a></li>
                
                    <li><a class="toctree-l4" href="#hypermedia-control-and-parameterized-urls">Hypermedia control and parameterized URLs</a></li>
                
                    <li><a class="toctree-l4" href="#backwards-and-forwards-compatibility">Backwards and forwards compatibility</a></li>
                
                    <li><a class="toctree-l4" href="#url-discovery">URL discovery</a></li>
                
                    <li><a class="toctree-l4" href="#api-usage-pattern">API usage pattern</a></li>
                
                    <li><a class="toctree-l4" href="#http-post-parameters">HTTP POST Parameters</a></li>
                
				</ul>
				
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../requests/">Requests</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../using-configuration-elements/">Using configuration elements</a>
			
		
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Store Service SDK</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../customization-sdk/">StoreFront Customization SDK</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../getting-started-with-the-sdk/">Getting started with the SDK</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../customization-interfaces/">Customization interfaces</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../known-issues/">Known issues</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../samples/">Samples</a>
			
		
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Authentication SDK</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../storefront-services-authentication-sdk/">Authentication Software Development Kit</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../citrix-common-forms-authentication-api/">Citrix Common Forms Authentication API</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../citrixauth-authentication-scheme/">CitrixAuth Authentication Scheme</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../common-authentication-forms-language/">Citrix Common Authentication Forms Language</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../security-token-services-api/">Security Token Services API</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../authentication-form-generation/">StoreFront Authentication Form Generation</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../known-issues-auth/">Known Issues</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../storeFront-authentication-sdk-thirdparty/">Third Party Notices</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../sample-certificate-identity-declaration/">Sample Certificate Identity Declaration</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../magic-word-sample/">Sample Magic Word</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../sample-test-forms/">Sample Test Forms</a>
			
		
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      


      
      <div class="wy-nav-content">
        <div class="rst-content">
         <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>StoreFront Web API &raquo;</li>
        
      
    
    <li>How the API works</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
          <div role="main">
            <div class="section">
             
                <h1 id="how-the-api-works"><a class="toclink" href="#how-the-api-works">How the API works</a></h1>
<p>This topic describes the behavior of the StoreFront Web API including authentication behavior, cookies, localization specifics, release compatibility and URL discovery.</p>
<h2 id="authentication-challenge"><a class="toclink" href="#authentication-challenge">Authentication challenge</a></h2>
<p>Some Web Proxy URLs are protected and require authentication information to allow access. If the required authentication information is not present, the Web Proxy returns an empty response (HTTP status code 200) with the following HTTP header:</p>
<pre class="codehilite"><code>CitrixWebReceiver-Authenticate: reason=&quot;TokenRequired&quot;,
location=&quot;Authentication/GetAuthMethods&quot;</code></pre>


<p>The location value in the challenge specifies a URL that the client requests (via Ajax) to determine which authentication methods are available. The challenge may contain an additional attribute <code>mode=Redirect</code>, which triggers the client to redirect to a 3rd party page instead to perform the authentication step.</p>
<p>Even after the user has authenticated, a challenge may be returned. For example, if the user's Web Proxy session has terminated for any reason, the <code>ASP.NET_SessionId cookie</code> is absent from the client request, or if the StoreFront credential wallet service has restarted.</p>
<p>Therefore, the client must be prepared to respond to such an authentication challenge at any time by prompting the user to re-authenticate to the site.</p>
<h2 id="client-name-client-address-and-device-id"><a class="toclink" href="#client-name-client-address-and-device-id">Client Name, Client Address and Device Id</a></h2>
<p>When the Web Proxy communicates with certain Store Service APIs, it supplies values for client name, client address and device id. These values are required for workspace control to function correctly. It is important that the Web Proxy passes consistent data for these parameters to all Store Services that take these parameters.</p>
<p>Client name specifies the hostname of the client machine and device id specifies a value unique to the client device. Since a typical browser-based client has limited access to the client OS and cannot determine the hostname, the Web Proxy automatically generates a random string value to use for both client name and device id. This value is returned to the client as a persistent cookie, named CtxsDeviceId, in a successful response (HTTP status 200) to a resource enumeration. It is expected that this cookie is returned by the client in subsequent requests.</p>
<p>Client address identifies the client IP address. This may be used on some XenApp/ XenDesktop systems to determine if a client should be presented with a particular resource. The Web Proxy automatically determines the client address from the Microsoft ASP.NET API <code>HttpRequest.UserHostAddress</code>, which returns the IP address of the client as seen at the web server. This may not be the actual client address; for example, if connecting through a NetScaler Gateway or other proxy server.</p>
<p>If multiple web browsers connect to a Citrix Receiver for Web site from the same client machine, a different (random) value for the CtxsDeviceId cookie is returned to each browser to represent the client name and device id. This results in the sessions being treated by the Store Services as running on separate devices. This may lead to apps disappearing and reappearing when performing session operations; for example, querying and reconnecting to sessions.</p>
<h2 id="cookies"><a class="toclink" href="#cookies">Cookies</a></h2>
<p>The Web Proxy sets a number of cookies as outlined in the table below. The client must return the cookies in subsequent requests, as indicated by the cookie life time.</p>
<table>
<thead>
<tr>
<th>Cookie</th>
<th>Life time</th>
<th>HttpOnly</th>
<th>When Set</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ASP.NET_SessionId</strong></td>
<td>Session</td>
<td>Yes</td>
<td>First response from Web Proxy</td>
<td>ASP.NET session id, represents the web session between client and Web Proxy.</td>
</tr>
<tr>
<td><strong>CtxsAuthId</strong></td>
<td>Session</td>
<td>Yes</td>
<td>Response indicating successful authentication</td>
<td>Protects against session fixation attacks</td>
</tr>
<tr>
<td><strong>CsrfToken</strong></td>
<td>Session</td>
<td>No</td>
<td>First response from Web Proxy</td>
<td>Protects against cross- site request forgery attacks</td>
</tr>
<tr>
<td><strong>CtxsDeviceId</strong></td>
<td>Persistent, 2 years</td>
<td>Yes</td>
<td>Response indicating successful resource enumeration</td>
<td>Specifies the value to use for client name and device id (see above)</td>
</tr>
</tbody>
</table>
<h2 id="https-indicator-to-secure-cookies"><a class="toclink" href="#https-indicator-to-secure-cookies">HTTPS indicator to secure cookies</a></h2>
<p>Unless specified otherwise, the Web Proxy API requires the client to indicate whether it is using an HTTPS connection or not by supplying a header named <code>X-Citrix- IsUsingHTTPS</code> with value "Yes" or "No". When the value is set to "Yes", the Web Proxy sets the Secure attribute for all cookies that it generates to protect them from being viewed from non-HTTPS connections. This caters for NetScaler Gateway scenarios where the connection from the browser to the gateway is over HTTPS but the connection from the gateway to the internal Citrix Receiver for Web site (where the Web Proxy runs) is HTTP.</p>
<h2 id="cross-site-request-forgery-token"><a class="toclink" href="#cross-site-request-forgery-token">Cross-site request forgery token</a></h2>
<p>To protect against cross-site request forgery (CSRF) attacks, the Web Proxy APIs require that a CSRF token be supplied by the client, unless specified otherwise. This is a random string generated by the Web Proxy for the duration of the session and communicated to the client using a session cookie. Clients must read the value of this cookie and send it back to the Web Proxy in most API calls, as either the value of a header named Csrf-Token (note the hyphen) for POST requests, or as the value of a query string parameter named CsrfToken for GET requests.</p>
<h2 id="localization"><a class="toclink" href="#localization">Localization</a></h2>
<p>Generally, the Web Proxy does not return user-facing strings to display in a UI. However, the authentication process uses the Citrix Common Forms protocol to obtain a definition of the logon form (amongst other forms), which typically includes strings for UI controls (for example, a "Username: " label or "Log On" button). The value specified in the Accept-Language HTTP header is used to determine the language for such strings. This value is also reflected back to the client in the response to the /Home/ Configuration request so that the client may perform any additional localization to match the language used for authentication forms.</p>
<h2 id="hypermedia-control-and-parameterized-urls"><a class="toclink" href="#hypermedia-control-and-parameterized-urls">Hypermedia control and parameterized URLs</a></h2>
<p>The StoreFront Web API uses the concept of hypermedia controls. With hypermedia controls, links to resources and actions are obtained from the server, either from the client configuration (/Home/Configuration) or directly as the result of calling this API. This means that clients must never construct URLs.
In these topics, various parameterized URLs are discussed, such as /Resources/ Subscription/{id}. It is important to note that these are indicative only, because the client code must not construct URLs directly. Instead, all parameterized URLs must be obtained from the service itself. For example, the URL to launch a particular resource must be extracted from the JSON data returned from the request to /Resources/List/.
In some cases, additional parameters can be supplied to a service that is invoked by a GET HTTP request. These parameters are supplied to the service by adding query string parameters to the base service URL. Clients must not make assumptions on the form of the service URL, which may vary with different releases. In particular, clients must not make assumptions about the presence or absence of query string parameters in the base service URL and must determine in each case whether new parameters should be appended with '?' or '&amp;'.</p>
<h2 id="backwards-and-forwards-compatibility"><a class="toclink" href="#backwards-and-forwards-compatibility">Backwards and forwards compatibility</a></h2>
<p>This is a preliminary revision of the Web Proxy API. No guarantees are made about backwards or forwards compatibility with any previous or future releases of Citrix Receiver for Web.</p>
<h2 id="url-discovery"><a class="toclink" href="#url-discovery">URL discovery</a></h2>
<p>When the JavaScript code executes in the browser, it first makes an Ajax request to the Web Proxy URL defined by the variable CTXS.configUrl (this defaults to /Home/ Configuration, but can be overridden by a JavaScript customization). This returns an XML document describing various Citrix Receiver for Web configuration settings, including a number of URL paths (relative to the site root) that the client must use for subsequent API calls. In addition to these "fixed" URLs, the client may later be sent additional URL paths specific to a given resource. For example, calling Resource/List returns JSON data describing all resources available to the user, including URL paths (per resource) for resource-specific operations such as launching a given resource or subscribing to a resource. These URL paths contain a resource id embedded within them.</p>
<h2 id="api-usage-pattern"><a class="toclink" href="#api-usage-pattern">API usage pattern</a></h2>
<p>At a high level, the client accesses the Web Proxy API by performing calls in the following order:</p>
<ol>
<li>Fetch the site configuration, to determine behavior and discover URLs for subsequent operations</li>
<li>Perform authentication, to allow access to resources</li>
<li>List sessions, to perform auto session reconnect at logon</li>
<li>List resources, to fetch additional (per-resource) URLs for launch and subscription operations</li>
<li>Launch and subscribe to resources in response to user actions in the UI</li>
</ol>
<h2 id="http-post-parameters"><a class="toclink" href="#http-post-parameters">HTTP POST Parameters</a></h2>
<p>Throughout the API, any request parameters in the POST body must follow standard form URL-encoding rules, with Content-Type set to:</p>
<pre class="codehilite"><code>application/x-www-form-urlencoded</code></pre>
              
               
            </div>
          </div>

        </div>
      </div>

    </section>

  </div>

<!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../overview/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../requests/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

</body>
</html>
