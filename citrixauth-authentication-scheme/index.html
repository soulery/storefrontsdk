<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>CitrixAuth Authentication Scheme - StoreFront SDK Documentation</title>
  

  <link rel="shortcut icon" href="
https://www.citrix.com/etc/designs/citrix/icon-favicon.png">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link rel="stylesheet" href="../css/override.css" type="text/css" />
  <link rel="stylesheet" href="../css/font-awesome.css" type="text/css" />

  
  <script>
    // Current page data
    var mkdocs_page_name = "CitrixAuth Authentication Scheme";
    var mkdocs_page_input_path = "citrixauth-authentication-scheme.md";
    var mkdocs_page_url = "/citrixauth-authentication-scheme/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script>
  <script src="../js/custom.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

	<div class="header-top">
		<div class="header-top-left">
			<a href="http://citrix.github.io" class="logo-position"><img height="60" src="https://thumbnail-ec2.sharefile.com/thumbnail.aspx?encparams=ypL2J0l-In6gqXJ7yeyKP8A1rqwKMH-C8-nfkJcHJNIN7Y0yZiJsYOcUe-uc0YeZzWLQSFSd1FnuMHPa30XSSINHuGOA8nvvnBT5WmjGlKvd5mxJ4IfT7iTVyHELwhWQiNCznPCiIFyhkA78uKX77PlU2iyhM4YdRM1NKabBe-4wXuiFJsbtAxyJ2UukO_E2ZSf1W3l75Dw8G0zflVkT-EFqyx1zSGId0qzLjm6nzJ8dA9zo-1AJzUisdzmGMzHOq_LMsOWyaalvmcWvCkl-q10GBSbfekfTIFW9LpZNYjkLNSnK8rcwNjWVr_jYayrGjIj2e5dDIMiDj3NRvW51AvHRjxYH9xRRRtY$" target="_blank" class="logo-citrix"><span style="color:#fff;font-size: 20px;position: relative;top:4px;left: 5px">SDK Reference</span></a>
		</div>
		<div class="header-top-right">
			<ul>
			<!--	<li class="list-inline home"><a href="..">HOME</a></li>
				<li class="list-inline support"><a href="http://support.citrix.com">SUPPORT</a></li>-->
			<form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
            <li class="list-inline support"><input name="q" id="txtName" type="text" placeholder="Search SDKs" 
            class="searchdocs"><a class="fa fa-search errspan" onclick="getElementById('rtd-search-form').submit()"></a></li>
			</form>
				<!--<li class="list-inline"><a href="http://citrix.com/download">DOWNLOADS</a></li>-->
			</ul>

		</div>
	</div>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
	<a class="fa fa-search" onclick="getElementById('rtd-search-form').submit()"></a>
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="..">Overview</a>
			
		
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Web API</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../overview/">Overview</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../how-the-api-works/">How the API works</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../requests/">Requests</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../using-configuration-elements/">Using configuration elements</a>
			
		
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Store Service SDK</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../customization-sdk/">StoreFront Customization SDK</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../getting-started-with-the-sdk/">Getting started with the SDK</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../customization-interfaces/">Customization interfaces</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../known-issues/">Known issues</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../samples/">Samples</a>
			
		
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span class="expul"><i class="fa fa-plus-square-o" aria-hidden="true"></i>StoreFront Authentication SDK</span></li>
        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../storefront-services-authentication-sdk/">Authentication Software Development Kit</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../citrix-common-forms-authentication-api/">Citrix Common Forms Authentication API</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 current">

		<a class="current" style="width:272px;" href="./">CitrixAuth Authentication Scheme</a>
			
		
        
            <ul style="display:none">
            
				
                <li class="toctree-l3"><span class="expcli" style="margin-left: 10px;"><i class="fa fa-plus-square-o" aria-hidden="true"></i></span><a href="#relying-party-authentication" style="display: inline-table;padding-left: 3px;width:240px;">Relying Party Authentication</a></li>
				<ul style="display:none">
                
                    <li><a class="toctree-l4" href="#scope">Scope</a></li>
                
                    <li><a class="toctree-l4" href="#citrixauth-scheme">CitrixAuth Scheme</a></li>
                
                    <li><a class="toctree-l4" href="#protection-space">Protection Space</a></li>
                
                    <li><a class="toctree-l4" href="#example">Example</a></li>
                
                    <li><a class="toctree-l4" href="#client-processing-of-a-challenge">Client Processing of a Challenge</a></li>
                
                    <li><a class="toctree-l4" href="#references">References</a></li>
                
				</ul>
				
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../common-authentication-forms-language/">Citrix Common Authentication Forms Language</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../security-token-services-api/">Security Token Services API</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../authentication-form-generation/">StoreFront Authentication Form Generation</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../known-issues-auth/">Known Issues</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../storeFront-authentication-sdk-thirdparty/">Third Party Notices</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../sample-certificate-identity-declaration/">Sample Certificate Identity Declaration</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../magic-word-sample/">Sample Magic Word</a>
			
		
        
    </li>

        
            
    <li class="toctree-l1 ">

		<a class="" style="width:272px;" href="../sample-test-forms/">Sample Test Forms</a>
			
		
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      


      
      <div class="wy-nav-content">
        <div class="rst-content">
         <!-- <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>StoreFront Authentication SDK &raquo;</li>
        
      
    
    <li>CitrixAuth Authentication Scheme</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div> -->
          <div role="main">
            <div class="section">
             
                <h1 id="relying-party-authentication"><a class="toclink" href="#relying-party-authentication">Relying Party Authentication</a></h1>
<h2 id="scope"><a class="toclink" href="#scope">Scope</a></h2>
<p>The purpose of this document is to describe the CitrixAuth authentication scheme used by the StoreFront Services Relying Parties to obtain user identity information.</p>
<h2 id="citrixauth-scheme"><a class="toclink" href="#citrixauth-scheme">CitrixAuth Scheme</a></h2>
<p>This section defines an RFC2617 [1] extension to support authentication to StoreFront Services Relying Parties, such as the resources service. The extension auth-scheme is CitrixAuth and is case-sensitive. It uses the standard HTTP Authorization and WWW-Authenticate HTTP headers as defined in RFC2617.</p>
<p>The headers have the following formats, in conformance with RFC2617:</p>
<p><code>Authorization: CitrixAuth {security-token}</code></p>
<p>If no valid Authorization header for the CitrixAuth scheme is found for the realm of the service it is sent to, then a challenge shall be issued as follows:</p>
<pre class="codehilite"><code>WWW-Authenticate: CitrixAuth realm=&quot;{service-id}&quot; , reqtokentemplate=&quot;{template}&quot;, 
                             reason=&quot;{reason-description}&quot;,locations=&quot;{url-list}&quot;,
                             serviceroot-hint=”{service-root}”</code></pre>


<p>The parameters are defined by the following:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>{service-id}</td>
<td>The unique identifier of the consuming service. With the hostname of the service being accessed it defines a Protection Space as per RFC2617 section 1.2</td>
</tr>
<tr>
<td>{security-token}</td>
<td>The serialized security token used to authenticate the user</td>
</tr>
<tr>
<td>{template}</td>
<td>This is a string that shall be passed by the client to the server when requesting a token for a specific service. The server can use this value to determine the token format to use. This value should be empty for current implementations, but must still be passed to the server.</td>
</tr>
<tr>
<td>{reason-description}</td>
<td>The reason why a challenge has been issued. This is to assist the client with managing cached tokens.</td>
</tr>
<tr>
<td>{url-list}</td>
<td>An ordered list of URLs separated by the ‘</td>
</tr>
<tr>
<td>{serviceroot}</td>
<td>A hint for the client as to the root URL for the protection space associated with the current request. This simplifies the client decision-making regarding sending cached tokens to respond to the challenge.</td>
</tr>
</tbody>
</table>
<p>The reason-description may be one of the following values:</p>
<ul>
<li>notoken: No authentication token was supplied.</li>
<li>expired: The supplied token is no longer valid.</li>
<li>notforthisservice: The token is valid, but was not issued for the service trying to consume it.</li>
<li>nottrusted: A valid token has been issued by a service that the consumer does not trust.</li>
<li>invalidtoken: The token extracted from the Authorization header was invalid, for example it may be badly formed.</li>
<li>passwordClaimNotFound: A required password claim was not found.</li>
<li>badpassword: For a password-based token, the password has been changed or has expired since the token was issued and is no longer valid.</li>
<li>badaccount: The account associated with the subject was invalid, for example it may be locked out.</li>
<li>invalidAudience: The original token was not requested for a valid audience (see below).</li>
<li>tokenSignatureNotVerified: The signature of the token could not be verified.</li>
<li>wrongclaims: The token does not contain the required claims.</li>
<li>gatewayclaimsinconsistent: The gateway identified in the supplied token does not match the gateway discovered by the relying party.</li>
</ul>
<h2 id="protection-space"><a class="toclink" href="#protection-space">Protection Space</a></h2>
<p>RFC2617 section 1.2 defines a Protection Space as the domain over which credentials can be automatically applied. If a prior request has been authorized, the same credentials may be reused for all other requests within that protection space for a period of time determined by the authentication scheme, parameters, and/or user preference. The CitrixAuth scheme is consistent with other schemes in that a single protection space cannot extend outside the scope of its server. The CitrixAuth scheme uses both the service-id (Realm) and the audience to which the request is to be sent, to define a protection space, and the client should not automatically send credentials to services outside of the protection space defined for a particular credential. In this context, the audience is defined by the scheme, host name, and port associated with the original request.
The serviceroot-hint in the challenge provides the client with the root of the protection space for the current request. This enables a better caching strategy in the client, if the initial request is not to the root of the protection space.</p>
<h2 id="example"><a class="toclink" href="#example">Example</a></h2>
<p>The following illustrates a CitrixAuth challenge and response:</p>
<p>Request to the Relying Party</p>
<pre class="codehilite"><code>GET https://www.example.com/Citrix/Store/resources/v2/T2VvUndOMEZMM1VBK2NpYzY4PQ--/image/16 HTTP/1.1
Host: www.example.com
Accept: image/png</code></pre>


<p>Response from the Relying Party</p>
<pre class="codehilite"><code>HTTP/1.1 401 Unauthorized
WWW-Authenticate: CitrixAuth realm=&quot;6b78ab94-a709-4e3a-8b9b-a49ca317c70c&quot;,
                             reqtokentemplate=&quot;&quot;, reason=&quot;notoken&quot;, 
                             locations=&quot;https://www.example.com/Citrix/Authentication/auth/v1/token&quot;,
                             serviceroot-hint=&quot;https://www.example.com/Citrix/Store2/resources/v2&quot;</code></pre>


<p>The client uses the information in the challenge to obtain an appropriate security token for the Service Provider, and then resends the original request with an attached Authorization header, as follows:</p>
<pre class="codehilite"><code>GET https://www.example.com/Citrix/Store/resources/v2/T2VvUndOMEZMM1VBK2NpYzY4PQ--/image/16 HTTP/1.1
Host: www.example.com
Accept: image/png
Authorization: CitrixAuth H4sIAAAAAAAEAO29B2AcSZYlJi9tynt/SvVK1+B0oQiAYBMk2JBAEOzBiM3mku…</code></pre>


<p>Response from the Relying Party</p>
<pre class="codehilite"><code>HTTP/1.1 200 OK
Content-Type: image/png
Cache-Control: public, no-store, max-age=0
Content-Length: 773

&lt;binary data&gt;</code></pre>


<h2 id="client-processing-of-a-challenge"><a class="toclink" href="#client-processing-of-a-challenge">Client Processing of a Challenge</a></h2>
<p>When a client receives a CitrixAuth challenge, it must respond by sending a Request Security Token message to the location specified in the challenge. For more information on the Request Security Token message see the StoreFront Security Token Services API document [2].
Consider the following example. The client has tried to access the URL: https://storefront.enterprise.com/Citrix/Store/resources/v2/launch
and received the following challenge:</p>
<pre class="codehilite"><code>WWW-Authenticate: CitrixAuth realm=&quot;d5c937a6-a09d-4805-adbb-ff92208f7466&quot;,
               reqtokentemplate=&quot;&quot;, reason=&quot;notoken&quot;,
               locations=&quot;https://storefront.enterprise.com/Citrix/Authentication/auth/v1/token&quot;
               serviceroot-hint=&quot;https://storefront.enterprise.com/Citrix/Store/resources/v2&quot;</code></pre>


<p>The client should respond by sending the following message to the location specified in the challenge, that is https://storefront.enterprise.com/Citrix/Authentication/auth/v1/token.</p>
<pre class="codehilite"><code>POST /Citrix/Authentication/auth/v1/token HTTP/1.1
Content-Type: application/vnd.citrix.requesttoken+xml
Accept: application/vnd.citrix.requesttokenresponse+xml, application/vnd.citrix.requesttokenchoices+xml
Content-Encoding: utf-8
Host: storefront.enterprise.com

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;requesttoken xmlns=&quot;http://citrix.com/delivery-services/1-0/auth/requesttoken&quot;&gt;
    &lt;for-service&gt;d5c937a6-a09d-4805-adbb-ff92208f7466&lt;/for-service&gt;
    &lt;for-service-url&gt;
      https://storefront.enterprise.com/Citrix/Store/resources/v2/launch
    &lt;/for-service-url&gt;
    &lt;reqtokentemplate&gt;&lt;/reqtokentemplate&gt;
    &lt;requested-lifetime&gt;01:00:00&lt;/requested-lifetime&gt;
&lt;/requesttoken&gt;</code></pre>


<div class="admonition info">
<p class="admonition-title">Notes</p>
<p>1.The request is sent to the value specified by the locations part of the challenge. </p>
<p>2.The <for-service> element value is extracted from the realm value of the challenge.</p>
<p>3.The <reqtokentemplate> element value is extracted from the reqtokentemplate value of the challenge. For current versions this is always empty.</p>
<p>4.The <for-service-url> element value should be the URL that the client originally called. This should NOT be the value of the serviceroot-hint from the challenge.</p>
</div>
<h2 id="references"><a class="toclink" href="#references">References</a></h2>
<p>[1] HTTP Authentication: Basic and Digest Access Authentication: http://www.ietf.org/rfc/rfc2617.txt </p>
<p>[2] StoreFront Security Token Services API v2.0</p>
              
               
            </div>
          </div>

        </div>
      </div>

    </section>

  </div>

<!--<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span class="prev"><a href="../citrix-common-forms-authentication-api/"><i class="fa fa-angle-left"></i> Previous</a></span>
      
      
        <span class="next"><a href="../common-authentication-forms-language/">Next <i class="fa fa-angle-right"></i></a></span>
      
    </span>
	<div class="footer-right">
		<ul class="social-links">
			<li class="list-inline"><a href="https://twitter.com/citrix"><i class="fa fa-twitter"></i>@citrix</a></li>
			<li class="list-inline"><a href="mailto:support@citrix.com"><i class="fa fa-envelope-o"></i>support@citrix.com</a></li>
		</ul>
		<ul class="inner-pages">
			<li class="list-inline"><a href="http://citrix.com/about/legal">Privacy and Terms</li>
		</ul>
	</div>
</div>-->

</body>
</html>
